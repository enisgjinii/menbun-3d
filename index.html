<!DOCTYPE html>
<html lang="en">

<head>
  <!-- (Existing head content) -->
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables for Theming */
    :root {
      --bg-color: #f8f9fa;
      --text-color: #343a40;
      --card-bg: #fff;
      --card-shadow: rgba(0, 0, 0, 0.1);
      --input-bg: #fff;
      --input-border: #ced4da;
      --placeholder-color: #6c757d;
    }

    [data-theme="dark"] {
      --bg-color: #212529;
      --text-color: #f8f9fa;
      --card-bg: #343a40;
      --card-shadow: rgba(255, 255, 255, 0.1);
      --input-bg: #343a40;
      --input-border: #495057;
      --placeholder-color: #adb5bd;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    #controls {
      width: 300px;
      background: var(--card-bg);
      padding: 15px;
      box-shadow: 2px 0 8px var(--card-shadow);
      overflow-y: auto;
      transition: width 0.3s ease;
      border-radius: 10px;
    }

    #model-container {
      flex-grow: 1;
      position: relative;
      background: var(--bg-color);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    h4 {
      color: var(--text-color);
      font-size: 18px;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    label {
      font-weight: 600;
      color: var(--text-color);
      font-size: 14px;
    }

    .btn {
      transition: background-color 0.3s, transform 0.2s;
      border-radius: 5px;
      padding: 8px 12px;
      font-size: 14px;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    input,
    select,
    textarea {
      border-radius: 5px;
      background-color: var(--input-bg);
      border-color: var(--input-border);
      color: var(--text-color);
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--placeholder-color);
    }

    #animateBtn {
      background-color: #0d6efd;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      font-size: 14px;
      width: 100%;
      margin-top: 10px;
    }

    #animateBtn:hover {
      background-color: #0b5ed7;
    }

    #editorCanvas {
      border: 2px dashed var(--input-border);
      border-radius: 8px;
      cursor: pointer;
      background-color: var(--input-bg);
      width: 100%;
      height: auto;
    }

    #controls::-webkit-scrollbar {
      width: 8px;
    }

    #controls::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.1);
      border-radius: 4px;
    }

    #controls::-webkit-scrollbar-thumb:hover {
      background-color: rgba(0, 0, 0, 0.2);
    }

    .toast-container {
      z-index: 1055;
    }

    .toast.fade.in.show {
      animation: slideIn 0.5s forwards;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.hide.out {
      animation: slideOut 0.5s forwards;
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }

      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    #propertiesPanel {
      width: 300px;
      background: var(--card-bg);
      padding: 20px;
      box-shadow: -2px 0 8px var(--card-shadow);
      overflow-y: auto;
    }

    @media(max-width:768px) {
      #controls {
        width: 100%;
        position: absolute;
        height: 100%;
        z-index: 1040;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      #controls.show {
        transform: translateX(0);
      }

      #propertiesPanel {
        display: none;
      }

      #toggleControlsBtn {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 1060;
      }
    }

    /* Pro Badge Style */
    #proBadge {
      font-size: 12px;
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <!-- Toggle Button for Mobile View -->
  <button class="btn btn-secondary d-md-none" id="toggleControlsBtn" type="button">
    <i class="bi bi-sliders"></i> Customize
  </button>
  <!-- Sidebar Controls -->
  <div id="controls" class="collapse d-md-block">
    <h4>
      Customize Your T-Shirt
      <span id="proBadge" class="badge bg-success ms-2" style="display: none;">Pro</span>
    </h4>
    <!-- Theme Mode Toggle -->
    <div class="form-group">
      <label for="modeToggle"><i class="bi bi-moon-stars me-2"></i>Theme Mode</label>
      <select id="modeToggle" class="form-select">
        <option value="system">System</option>
        <option value="time">Auto (Time-based)</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
    </div>
    <!-- Change Color -->
    <div class="form-group">
      <label for="colorPicker"><i class="bi bi-palette-fill me-2"></i>Change T-Shirt Color</label>
      <input type="color" id="colorPicker" class="form-control form-control-color" value="#ffffff"
        title="Choose your T-shirt color">
    </div>
    <!-- Add Text -->
    <div class="form-group">
      <label for="textInput"><i class="bi bi-type me-2"></i>Add Text to T-Shirt</label>
      <input type="text" id="textInput" class="form-control" placeholder="Enter your text"
        title="Enter text to add to T-shirt">
      <div class="mt-2">
        <label for="fontSize" class="form-label">Font Size</label>
        <input type="range" id="fontSize" class="form-range" min="10" max="100" value="30" title="Adjust font size">
      </div>
      <button id="addTextBtn" class="btn btn-success w-100 mt-2">
        <i class="bi bi-plus-circle me-2"></i>Add Text
        <span id="addTextPro" class="badge bg-warning text-dark ms-2" style="display: none;">Pro</span>
      </button>
    </div>
    <!-- Upload Image -->
    <div class="form-group">
      <label for="imageUpload"><i class="bi bi-image-fill me-2"></i>Upload Image to T-Shirt</label>
      <input type="file" id="imageUpload" class="form-control" accept="image/*" title="Upload an image file">
      <button id="addImageBtn" class="btn btn-success w-100 mt-2">
        <i class="bi bi-plus-circle me-2"></i>Add Image
      </button>
    </div>
    <!-- Position Elements -->
    <div class="form-group">
      <label><i class="bi bi-grid-3x3-gap-fill me-2"></i>Position Elements</label>
      <canvas id="editorCanvas" width="280" height="350"></canvas>
      <small class="form-text text-muted">Drag texts and images to position them on the T-shirt.</small>
    </div>
    <!-- View Settings -->
    <div class="form-group">
      <label class="form-label"><i class="bi bi-tools me-2"></i>View Settings</label>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleWireframe">
        <label class="form-check-label" for="toggleWireframe">Wireframe Mode</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleGrid">
        <label class="form-check-label" for="toggleGrid">Show Grid</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleShadows" checked>
        <label class="form-check-label" for="toggleShadows">Enable Shadows</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleAmbientLight" checked>
        <label class="form-check-label" for="toggleAmbientLight">Ambient Light</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleDirectionalLight" checked>
        <label class="form-check-label" for="toggleDirectionalLight">Directional Light</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleSpotlights" checked>
        <label class="form-check-label" for="toggleSpotlights">Spotlights</label>
      </div>
      <div class="form-check form-switch mb-1">
        <input class="form-check-input" type="checkbox" id="toggleModelVisibility" checked>
        <label class="form-check-label" for="toggleModelVisibility">Model Visibility</label>
      </div>

    </div>
    <!-- Animate Button -->
    <button id="animateBtn" class="btn btn-primary">
      <i class="bi bi-play-circle me-2"></i>Animate
    </button>
  </div>
  <!-- Model Container -->
  <div id="model-container"></div>
  <!-- Properties Panel -->
  <div id="propertiesPanel">
    <p>Select an element to edit its properties.</p>
  </div>
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Main JS Module -->
  <script type="module" src="/src/main.js"></script>
  <!-- Theme Mode Script -->
  <script>
    // Function to apply the selected theme
    const applyTheme = (theme) => {
      if (theme === 'system') {
        document.documentElement.removeAttribute('data-theme');
      } else if (theme === 'time') {
        // Get current hour in user's local time
        const currentHour = new Date().getHours();
        if (currentHour >= 19 || currentHour < 7) {
          // Between 7 PM and 7 AM
          document.documentElement.setAttribute('data-theme', 'dark');
        } else {
          document.documentElement.setAttribute('data-theme', 'light');
        }
      } else {
        document.documentElement.setAttribute('data-theme', theme);
      }
    };
    // Function to handle time-based theme switching
    const timeBasedTheme = () => {
      if (localStorage.getItem('theme') === 'time') {
        applyTheme('time');
      }
    };
    // Get saved theme from localStorage or default to 'system'
    let savedTheme = localStorage.getItem('theme') || 'system';
    const modeToggle = document.getElementById('modeToggle');
    if (modeToggle) {
      modeToggle.value = savedTheme;
    }
    applyTheme(savedTheme);
    // Event listener for the theme toggle dropdown
    if (modeToggle) {
      modeToggle.addEventListener('change', function () {
        let selectedTheme = this.value;
        localStorage.setItem('theme', selectedTheme);
        applyTheme(selectedTheme);
      });
    }
    // Listener for system preference changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (localStorage.getItem('theme') === 'system') {
        applyTheme('system');
      }
    });
    // Set an interval to check for time-based theme updates every 30 minutes
    setInterval(timeBasedTheme, 1800000); // 30 minutes in milliseconds
    // Initial call to handle time-based theme
    timeBasedTheme();
    // Toggle Controls Script
    const toggleControlsBtn = document.getElementById('toggleControlsBtn');
    const controls = document.getElementById('controls');
    if (toggleControlsBtn && controls) {
      toggleControlsBtn.addEventListener('click', () => {
        controls.classList.toggle('show');
      });
    }
  </script>
</body>

</html>